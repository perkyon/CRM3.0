# Руководство по системе производства

## Обзор

Новая система производства позволяет управлять процессом изготовления мебели от выбора компонентов до контроля этапов производства.

## Архитектура

### Поток работы
1. **Выбор компонентов** - выбор типов помещений (кухня, гостинная, спальня и т.д.)
2. **Выбор подкомпонентов** - выбор конкретных элементов (раковина, гарнитур, стол и т.д.)
3. **Управление производством** - канбан-доска с этапами производства

### Структура данных
```
Project → Components → SubComponents → ProductionStages
```

## Компоненты

### 1. ComponentSelector
- **Файл**: `src/components/production/ComponentSelector.tsx`
- **Назначение**: Выбор типов помещений для проекта
- **Функции**:
  - Отображение доступных типов компонентов
  - Выбор нескольких компонентов
  - Создание компонентов в проекте

### 2. SubComponentSelector
- **Файл**: `src/components/production/SubComponentSelector.tsx`
- **Назначение**: Выбор конкретных элементов для выбранного компонента
- **Функции**:
  - Отображение подкомпонентов для выбранного типа
  - Поиск по названию
  - Добавление кастомных элементов
  - Создание подкомпонентов

### 3. ProductionKanban
- **Файл**: `src/components/production/ProductionKanban.tsx`
- **Назначение**: Управление этапами производства
- **Функции**:
  - Канбан-доска с этапами производства
  - Фильтрация по исполнителю, приоритету, тегам
  - Изменение статуса задач
  - Назначение исполнителей
  - Отслеживание времени

### 4. ProductionManager
- **Файл**: `src/components/production/ProductionManager.tsx`
- **Назначение**: Главный компонент для управления всем процессом
- **Функции**:
  - Навигация между этапами
  - Управление состоянием
  - Интеграция всех компонентов

## База данных

### Новые таблицы

#### project_components
- Хранит компоненты проекта (кухня, гостинная и т.д.)
- Связана с таблицей projects

#### project_subcomponents
- Хранит подкомпоненты (раковина, гарнитур и т.д.)
- Связана с project_components

#### production_stages
- Хранит этапы производства для каждого подкомпонента
- Связана с project_subcomponents и users

#### component_templates
- Шаблоны для быстрого создания компонентов
- Содержит предустановленные подкомпоненты и этапы

### Типы данных

#### ComponentType
```typescript
type ComponentType = 
  | 'kitchen'      // Кухня
  | 'living_room'  // Гостинная
  | 'bedroom'      // Спальня
  | 'wardrobe'     // Гардеробная
  | 'bathroom'     // Ванная
  | 'children_room' // Детская
  | 'office'       // Офис
  | 'hallway'      // Прихожая
  | 'balcony'      // Балкон
  | 'other';       // Прочее
```

#### SubComponentType
```typescript
type SubComponentType = 
  | 'sink'         // Раковина
  | 'kitchen_set'  // Гарнитур
  | 'cabinet'      // Шкаф
  | 'table'        // Стол
  | 'chair'        // Стул
  | 'bed'          // Кровать
  | 'wardrobe'     // Шкаф-купе
  | 'sofa'         // Диван
  | 'tv_stand'     // ТВ-тумба
  | 'shelf'        // Полка
  | 'mirror'       // Зеркало
  | 'bathroom_set' // Ванная комплект
  | 'other';       // Прочее
```

#### ProductionStageType
```typescript
type ProductionStageType = 
  | 'cnc_cutting'  // Вырез на ЧПУ
  | 'sanding'      // Шлифовка
  | 'painting'     // Покраска
  | 'assembly'     // Сборка
  | 'quality_control' // Контроль качества
  | 'packaging'    // Упаковка
  | 'delivery';    // Доставка
```

## API Сервисы

### ProductionService
- **Файл**: `src/lib/supabase/services/ProductionService.ts`
- **Функции**:
  - CRUD операции для компонентов
  - CRUD операции для подкомпонентов
  - CRUD операции для этапов производства
  - Работа с шаблонами
  - Получение статистики производства

## Роутинг

### Новые роуты
- `/production/:projectId` - главная страница управления производством

### Интеграция
- Кнопка "Перейти к производству" в ProjectOverview ведет на новый роут

## Использование

### 1. Запуск системы производства
1. Откройте проект в ProjectOverview
2. Нажмите кнопку "Перейти к производству"
3. Начните с выбора компонентов

### 2. Выбор компонентов
1. Выберите типы помещений (кухня, гостинная и т.д.)
2. Нажмите "Создать компоненты"
3. Переходите к выбору подкомпонентов

### 3. Выбор подкомпонентов
1. Выберите компонент из списка
2. Выберите конкретные элементы (раковина, гарнитур и т.д.)
3. Можете добавить кастомные элементы
4. Нажмите "Создать элементы"

### 4. Управление производством
1. Выберите элемент из списка
2. Управляйте этапами производства в канбан-доске
3. Назначайте исполнителей
4. Отслеживайте прогресс

## Настройка

### Добавление новых типов компонентов
1. Обновите enum `ComponentType` в `src/types/index.ts`
2. Добавьте название в `componentNames` в `src/lib/constants/production.ts`
3. Добавьте иконку в `componentIcons`

### Добавление новых подкомпонентов
1. Обновите enum `SubComponentType` в `src/types/index.ts`
2. Добавьте название в `subComponentNames`
3. Добавьте иконку в `subComponentIcons`

### Добавление новых этапов производства
1. Обновите enum `ProductionStageType` в `src/types/index.ts`
2. Добавьте название в `productionStageNames`
3. Добавьте иконку в `productionStageIcons`

## Миграция базы данных

Для применения новой схемы базы данных выполните:

```sql
-- Примените файл supabase/production-schema.sql
\i supabase/production-schema.sql
```

## Будущие улучшения

1. **Интеграция с календарем** - планирование этапов по времени
2. **Уведомления** - уведомления о смене статуса задач
3. **Отчеты** - детальные отчеты по производству
4. **Мобильная версия** - оптимизация для мобильных устройств
5. **Интеграция с 1С** - синхронизация с учетными системами
